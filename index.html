<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TABRIZ GROUP | PRO SYSTEM</title>
    <style>
        :root { 
            --gold: #d4af37; --accent: #b8860b; --dark: #020617; 
            --glass: rgba(15, 23, 42, 0.95); --border: rgba(255, 255, 255, 0.1);
        }
        
        body, html { 
            margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: var(--dark); color: white; height: 100vh; overflow: hidden;
        }

        .background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(2, 6, 23, 0.8), rgba(2, 6, 23, 0.9)), 
                        url('https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?q=80&w=2000&auto=format&fit=crop');
            background-size: cover; z-index: -1;
        }

        .container {
            display: flex; justify-content: center; align-items: center; height: 100vh; padding: 20px;
        }

        /* “≤–∞—Ä –±–∏—Ä –æ–π–Ω–∞ (Screen) —É—á—É–Ω —Å—Ç–∏–ª */
        .screen {
            display: none; width: 100%; max-width: 500px;
            background: var(--glass); backdrop-filter: blur(20px);
            border-radius: 30px; border: 1px solid var(--border);
            padding: 35px; box-sizing: border-box;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            animation: fadeIn 0.4s ease;
        }

        .screen.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        h1 { color: var(--gold); text-align: center; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 25px; }

        input, select { 
            width: 100%; padding: 14px; margin-bottom: 15px;
            background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            border-radius: 12px; color: white; outline: none; box-sizing: border-box;
        }

        .btn { 
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            background: linear-gradient(135deg, var(--gold), var(--accent));
            color: black; font-weight: bold; cursor: pointer; text-transform: uppercase;
        }

        .btn-outline { background: transparent; border: 1px solid var(--border); color: white; margin-top: 10px; }

        .scroll-box { max-height: 300px; overflow-y: auto; margin-bottom: 20px; padding-right: 5px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { color: var(--gold); padding: 10px; border-bottom: 1px solid var(--border); text-align: left; }
        td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }

        .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .cat-card { 
            padding: 20px; border: 1px solid var(--border); border-radius: 15px; 
            text-align: center; cursor: pointer; transition: 0.3s;
        }
        .cat-card:hover { border-color: var(--gold); background: rgba(212, 175, 55, 0.1); }

        canvas { background: white; border-radius: 20px; width: 100%; margin-top: 15px; }

        .nav-link { display: block; text-align: center; margin-top: 20px; color: #888; text-decoration: none; cursor: pointer; }
    </style>
</head>
<body>

<div class="background"></div>

<div class="container">

    <div id="scr-login" class="screen active">
        <h1>TABRIZ | –ö–ò–†–ò–®</h1>
        <input type="tel" id="user-phone" value="+998">
        <button class="btn" onclick="sendAuthCode()">–ö–æ–¥ –æ–ª–∏—à</button>
        <div id="auth-code-box" style="display:none; margin-top:20px;">
            <input type="number" id="auth-code-input" placeholder="–ö–æ–¥–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥">
            <button class="btn" onclick="verifyAuth()">–¢–∏–∑–∏–º–≥–∞ –∫–∏—Ä–∏—à</button>
        </div>
    </div>

    <div id="scr-cabinet" class="screen">
        <h1>–ö–ê–ë–ò–ù–ï–¢</h1>
        <p style="text-align:center;">–•—É—à –∫–µ–ª–∏–±—Å–∏–∑!</p>
        <h3 id="display-phone" style="text-align:center; color:var(--gold);"></h3>
        <button class="btn" onclick="showScreen('scr-catalog')">‚ûï –Ø–Ω–≥–∏ –±—É—é—Ä—Ç–º–∞</button>
        <button class="btn btn-outline" onclick="alert('–¢–∞—Ä–∏—Ö –±—û—à')">üìã –¢–∞—Ä–∏—Ö</button>
        <span class="nav-link" onclick="location.reload()">–ß–∏“õ–∏—à</span>
    </div>

    <div id="scr-catalog" class="screen">
        <h1>–ö–ê–¢–ê–õ–û–ì</h1>
        <div class="cat-grid">
            <div class="cat-card" onclick="selectMaterial('–õ–î–°–ü –û“õ', '2800x2070')"><b>–õ–î–°–ü</b><br>–û“õ</div>
            <div class="cat-card" onclick="selectMaterial('–õ–ú–î–§ –ö—É–ª—Ä–∞–Ω–≥', '2800x1220')"><b>–õ–ú–î–§</b><br>–ö—É–ª—Ä–∞–Ω–≥</div>
            <div class="cat-card" onclick="selectMaterial('–ê–∫—Ä–∏–ª “ö–æ—Ä–∞', '2800x1220')"><b>–ê–∫—Ä–∏–ª</b><br>“ö–æ—Ä–∞</div>
            <div class="cat-card" onclick="selectMaterial('–ú—Ä–∞–º–æ—Ä', '3050x600')"><b>Mebel</b><br>–ú—Ä–∞–º–æ—Ä</div>
        </div>
        <span class="nav-link" onclick="showScreen('scr-cabinet')">‚¨Ö –û—Ä“õ–∞–≥–∞</span>
    </div>

    <div id="scr-order" class="screen" style="max-width:700px;">
        <h1 id="order-mat-name">–é–õ–ß–ê–ú–õ–ê–†</h1>
        <div class="scroll-box">
            <table>
                <thead>
                    <tr><th>–ë—û–π–∏ (L)</th><th>–≠–Ω–∏ (W)</th><th>–°–æ–Ω–∏</th><th>–ö—Ä–æ–º–∫–∞</th><th></th></tr>
                </thead>
                <tbody id="parts-table"></tbody>
            </table>
        </div>
        <button class="btn btn-outline" onclick="addNewRow()">+ –î–µ—Ç–∞–ª “õ—û—à–∏—à</button>
        <button class="btn" style="margin-top:15px;" onclick="startNesting()">üìê “≤–∏—Å–æ–±–ª–∞—à</button>
        <span class="nav-link" onclick="showScreen('scr-catalog')">‚¨Ö –ö–∞—Ç–∞–ª–æ–≥–≥–∞ “õ–∞–π—Ç–∏—à</span>
    </div>

    <div id="scr-optim" class="screen" style="max-width:750px;">
        <h1>–ß–ò–ó–ú–ê</h1>
        <canvas id="nestCanvas"></canvas>
        <div style="display:flex; justify-content:space-around; margin-top:20px; font-weight:bold;">
            <span>ü©π –ö—Ä–æ–º–∫–∞: <span id="res-edge" style="color:var(--gold)">0</span> –º.–ø.</span>
            <span>üì¶ –õ–∏—Å—Ç: <span id="res-sheets" style="color:var(--gold)">1</span> —Ç–∞</span>
        </div>
        <button class="btn" style="margin-top:20px;" onclick="showScreen('scr-report')">üìä “≤–∏—Å–æ–±–æ—Ç–Ω–∏ –∫—û—Ä–∏—à</button>
    </div>

    <div id="scr-report" class="screen">
        <h1>–Ø–ö–£–ù–ò–ô “≤–ò–°–û–ë–û–¢</h1>
        <div id="final-report-box" style="background:rgba(0,0,0,0.3); padding:20px; border-radius:15px; font-size:14px; line-height:1.6;">
            </div>
        <button class="btn" style="margin-top:20px;" onclick="sendOrderToBot()">üöÄ –ë–æ—Ç–≥–∞ —é–±–æ—Ä–∏—à</button>
        <span class="nav-link" onclick="showScreen('scr-optim')">‚¨Ö –ß–∏–∑–º–∞–Ω–∏ –∫—û—Ä–∏—à</span>
    </div>

</div>

<script>
    const BOT_TOKEN = "7927717291:AAG4h_LbZoY-1s2y0_zzNoCFudrU7pPDNas";
    const ADMIN_ID = "1015769230";
    let tempCode, userPhone, selectedMat;

    // –≠–∫—Ä–∞–Ω–ª–∞—Ä–Ω–∏ –∞–ª–º–∞—à—Ç–∏—Ä–∏—à —Ñ—É–Ω–∫—Ü–∏—è—Å–∏
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // 1. –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
    async function sendAuthCode() {
        userPhone = document.getElementById('user-phone').value;
        tempCode = Math.floor(1000 + Math.random() * 9000);
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_ID}&text=${encodeURIComponent('üîë TABRIZ –ö–ò–†–ò–® –ö–û–î–ò: ' + tempCode + '\nüìû –¢–µ–ª: ' + userPhone)}`);
        document.getElementById('auth-code-box').style.display = 'block';
        alert("–ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–≥–∞ —é–±–æ—Ä–∏–ª–¥–∏!");
    }

    function verifyAuth() {
        if(document.getElementById('auth-code-input').value == tempCode) {
            document.getElementById('display-phone').innerText = userPhone;
            showScreen('scr-cabinet');
        } else alert("–•–∞—Ç–æ –∫–æ–¥!");
    }

    // 2. –ö–ê–¢–ê–õ–û–ì
    function selectMaterial(name, size) {
        selectedMat = { name, w: parseInt(size.split('x')[0]), h: parseInt(size.split('x')[1]) };
        document.getElementById('order-mat-name').innerText = name;
        showScreen('scr-order');
        if(document.getElementById('parts-table').children.length === 0) addNewRow();
    }

    // 3. –î–ï–¢–ê–õ–õ–ê–†
    function addNewRow() {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><input type="number" class="l" value="600"></td>
            <td><input type="number" class="w" value="400"></td>
            <td><input type="number" class="q" value="1"></td>
            <td><div style="display:flex;gap:2px"><input type="checkbox" class="e1"><input type="checkbox" class="e2"><input type="checkbox" class="e3"><input type="checkbox" class="e4"></div></td>
            <td onclick="this.parentElement.remove()" style="cursor:pointer">‚ùå</td>
        `;
        document.getElementById('parts-table').appendChild(tr);
    }

    // 4. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø (–ß–ò–ó–ò–®)
    function startNesting() {
        const canvas = document.getElementById('nestCanvas');
        const ctx = canvas.getContext('2d');
        const scale = 0.22;
        canvas.width = selectedMat.w * scale;
        canvas.height = selectedMat.h * scale;

        ctx.fillStyle = "white"; ctx.fillRect(0,0,canvas.width,canvas.height);

        let totalEdge = 0, curX = 5, curY = 5, rowH = 0;
        let reportDetails = "";

        document.querySelectorAll('#parts-table tr').forEach((row, i) => {
            const L = parseInt(row.querySelector('.l').value);
            const W = parseInt(row.querySelector('.w').value);
            const Q = parseInt(row.querySelector('.q').value);
            const ed = [row.querySelector('.e1').checked, row.querySelector('.e2').checked, row.querySelector('.e3').checked, row.querySelector('.e4').checked];
            
            totalEdge += ((ed[0]?L:0)+(ed[1]?L:0)+(ed[2]?W:0)+(ed[3]?W:0)) * Q;
            const edStr = (ed[0]?'L1 ':'')+(ed[1]?'L2 ':'')+(ed[2]?'W1 ':'')+(ed[3]?'W2 ':'');
            reportDetails += `${i+1}. ${L}x${W} | ${Q}—Ç–∞ | –ö—Ä–æ–º–∫–∞: ${edStr || '–π—û“õ'}<br>`;

            for(let j=0; j<Q; j++) {
                if(curX + L*scale > canvas.width - 5) { curX = 5; curY += rowH + 2; rowH = 0; }
                ctx.fillStyle = "rgba(212, 175, 55, 0.2)";
                ctx.fillRect(curX, curY, L*scale, W*scale);
                ctx.strokeStyle = "#b8860b"; ctx.strokeRect(curX, curY, L*scale, W*scale);
                
                // –ö—Ä–æ–º–∫–∞ —á–∏–∑–∏“ì–∏
                ctx.strokeStyle = "red"; ctx.lineWidth = 2;
                if(ed[0]) { ctx.beginPath(); ctx.moveTo(curX, curY); ctx.lineTo(curX+L*scale, curY); ctx.stroke(); }
                if(ed[1]) { ctx.beginPath(); ctx.moveTo(curX, curY+W*scale); ctx.lineTo(curX+L*scale, curY+W*scale); ctx.stroke(); }
                
                curX += L*scale + 2;
                rowH = Math.max(rowH, W*scale);
            }
        });

        document.getElementById('res-edge').innerText = (totalEdge/1000).toFixed(2);
        document.getElementById('final-report-box').innerHTML = `<b>–ú–∞—Ç–µ—Ä–∏–∞–ª:</b> ${selectedMat.name}<br><b>–é–ª—á–∞–º:</b> ${selectedMat.w}x${selectedMat.h}<hr>${reportDetails}`;
        showScreen('scr-optim');
    }

    // 5. –¢–ï–õ–ï–ì–†–ê–ú–ì–ê –Æ–ë–û–†–ò–®
    async function sendOrderToBot() {
        const report = document.getElementById('final-report-box').innerText;
        const edge = document.getElementById('res-edge').innerText;
        const msg = `üöÄ –Ø–ù–ì–ò –ë–£–Æ–†–¢–ú–ê: TABRIZ GROUP\nüë§ –ú–∏–∂–æ–∑: ${userPhone}\n\n${report}\nü©π –ñ–∞–º–∏ –∫—Ä–æ–º–∫–∞: ${edge} –º.–ø.`;
        
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_ID}&text=${encodeURIComponent(msg)}`);
        alert("–ë—É—é—Ä—Ç–º–∞ –º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç–ª–∏ —é–±–æ—Ä–∏–ª–¥–∏!");
        showScreen('scr-cabinet');
    }
</script>

</body>
</html>
